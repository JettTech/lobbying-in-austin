<!DOCTYPE html>
<meta charset="utf-8">

<style>

div.tooltip {   
  position: absolute;           
  text-align: center;           
  width: 60px;                  
  height: 15px;                 
  padding: 2px;             
  font: 12px sans-serif;        
  background: lightsteelblue;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;         
}

svg {
    background-color: blue;
}


</style>

<header></header>

<body>

<!-- <div class='poop'>FU</div>

<div class='poop'> YAYAYSYYS</div> -->

</body>


<script src="./d3/d3.js"></script>

<script type="text/javascript">

// (function(d3) {
// 'use strict';

// REMOVED var data = ...

var width = 600;
var height = 250;
var buffer_width = 15;
var plot_w = width - 2*buffer_width
var plot_h = height - 2*buffer_width
//var radius = Math.min(width, height) / 2;
//var donutWidth = 75;
var legendRectSize = 18;
var legendSpacing = 4;
var max_x_val = -Infinity
var min_x_val = Infinity
var max_y_val = -Infinity
var min_y_val = 0

var color = d3.scale.category20b();


  // .attr('transform', 'translate(' + (width / 2) + 
  //   ',' + (height / 2) + ')');

// var arc = d3.svg.arc()
//   .innerRadius(radius - donutWidth)
//   .outerRadius(radius);

var div = d3.select("body").append("div")   
    .attr("class", "tooltip")               
    .style("opacity", 0);


var x_cor = function(year, month) {
  total_years = max_x_val - min_x_val
  total_sections = total_years*12
  section = (year-min_x_val-1)*12 + month
  xloc = buffer_width + (section / total_sections)*(plot_w)
  //console.log(xloc)
  return xloc
};

var y_cor = function(clients) {
  yloc = (height - buffer_width) - (clients / max_y_val)*plot_h
  //console.log(yloc)
  return yloc
};

// var get_tooltip_height = function(len_of_string) {


//   // var test = document.getElementById("Test");
//   // test.style.fontSize = fontSize;
//   // var height = (test.clientHeight + 1) + "px";
//   // var width = (test.clientWidth + 1) + "px";

//   div_width = div.clientWidth


//   // div_width = +div.style("width").match('[0-9]*(?=px)')
//   // char_width = +div.style("font").match('[0-9]*(?=px)')
  

//   console.log(div_width);

//   // if (len_of_string*char_width > div_width) {
//   //   return +div.style("height").match('[0-9]*(?=px)')*2
//   // }

//   // else {
//   //   return +div.style("height").match('[0-9]*(?=px)')
//   // }
// };


var color = d3.scale.category10();
var xAxis = d3.svg.axis();

// Getting data 

var svg = d3.select('body')
  .append('svg')
  .attr('width', width)
  .attr('height', height)
 .style("background-color", 'purple')
  .append('g')

d3.csv("./data/clients_by_time_industry.csv", function(error, data) {

  // change string (from CSV) into number format
  data.forEach(function(d) {
    d.month_of_hire = +d.month_of_hire;
    d.year_of_hire = +d.year_of_hire;
    if (d.year_of_hire > max_x_val) {
      max_x_val = d.year_of_hire
    };
    if (d.year_of_hire < min_x_val) {
      min_x_val = d.year_of_hire
    };
    d.clients = +d.clients;
    if (d.clients > max_y_val) {
      max_y_val = d.clients
    };
  });


  var color_domain = d3.map(data, function(d){return d.industry;}).keys()
  color.domain(color_domain)

  svg.selectAll(".dot")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot")
      .attr("r", 3.5)
      .attr("cx", function(d) {return x_cor(d.year_of_hire,d.month_of_hire)})
      .attr("cy", function(d) {return y_cor(d.clients)})
      .style("fill", function(d){return color(d.industry)})
      .on("mouseover", function(d) {
          div.transition()
               .duration(200)
               .style("opacity", .9);
          div.html(d.industry)
               .style("left", (d3.event.pageX + 5) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
               //.style("height", (get_tooltip_height(d.industry.length)));





      });





</script>
